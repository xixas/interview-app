<div class="page-container">
  <app-page-header 
    title="Settings"
    description="Configure your Interview App preferences"
    icon="pi pi-cog">
  </app-page-header>

  <div class="flex justify-center">
    <!-- OpenAI Configuration Card - Centered with max width -->
    <div class="w-full max-w-2xl">
      <div class="card mb-0">
        <div class="card-header">
          <div class="flex items-center gap-3 mb-2">
            <i class="pi pi-sparkles header-icon"></i>
            <h2 class="text-surface-900 dark:text-surface-0 font-medium text-xl">OpenAI Configuration</h2>
          </div>
          <p>Configure your OpenAI API key for AI-powered interview evaluation</p>
        </div>

        <div class="form-section">
          <!-- API Key Input -->
          <div class="form-group">
            <label for="apiKey" class="text-surface-900 dark:text-surface-0 font-medium mb-2 block">
              API Key
              <span class="required">*</span>
            </label>
            <div class="form-row">
              <div class="flex-1">
                <p-password
                  id="apiKey"
                  [(ngModel)]="apiKey"
                  placeholder="sk-..."
                  class="w-full"
                  inputStyleClass="w-full"
                  [feedback]="false"
                  [toggleMask]="true"
                  autocomplete="off">
                </p-password>
              </div>
              <button 
                pButton 
                type="button" 
                [label]="apiKeyStatus().status === 'testing' ? 'Testing...' : 'Test'"
                icon="pi pi-check-circle"
                class="p-button-outlined"
                [loading]="apiKeyStatus().status === 'testing'"
                [disabled]="!apiKey().trim() || apiKeyStatus().status === 'testing'"
                (click)="testApiKey()"
                pTooltip="Test API key connection">
              </button>
            </div>
            <small>
              Get your API key from 
              <a href="#" class="text-primary cursor-pointer" (click)="openOpenAIWebsite()">
                OpenAI Platform
              </a>
            </small>
          </div>

          <!-- Status Message -->
          @if (apiKeyStatus().status !== 'none' && apiKeyStatus().status !== 'testing') {
            <div class="api-status">
              @switch (apiKeyStatus().status) {
                @case ('valid') {
                  <p-message severity="success">{{ apiKeyStatus().message }}</p-message>
                }
                @case ('invalid') {
                  <p-message severity="warn">{{ apiKeyStatus().message }}</p-message>
                }
                @case ('error') {
                  <p-message severity="error">{{ apiKeyStatus().message }}</p-message>
                }
              }
            </div>
          }

          <!-- Action Buttons -->
          <div class="flex gap-2 pt-2">
            <button 
              pButton 
              type="button" 
              label="Save API Key"
              icon="pi pi-save"
              [disabled]="!apiKey().trim() || isSaving() || apiKeyStatus().status === 'testing'"
              [loading]="isSaving()"
              (click)="saveApiKey()">
            </button>
            <button 
              pButton 
              type="button" 
              label="Clear"
              icon="pi pi-times"
              class="p-button-outlined p-button-secondary"
              [disabled]="!apiKey().trim() || isSaving()"
              (click)="clearApiKey()">
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>